{"version":3,"sources":["../build/Converter.js"],"names":["formats","ADDFormat","AmbidecodeCoefs","AmbidecodeSettings","IEMFormat","ParserMessageLevels","ParserMessage","constructor","mess","level","message","ParseResults","results","incomplete_results","messages","ConvertableTextFile","fname","data","filename","ConverterOption","name","value","used","type","peek","wasUsed","use","ConverterOptions","args","options","has","find","opt","undefined","get","getUnused","reduce","carry","current","push","Converter","convert_string","files","file","ftype","slice","lastIndexOf","charAt","_do_parse_json","_do_parse_xml","_do_parse_add","convert_binary","list_formats","opts","_do_parse_native","JSON","parse","ContainerType","ignoreAttributes","XML","obj","container_type","parsers_to_try","output_file","console","log","format","test","forEach","p","parser"],"mappings":"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","sourcesContent":["import { ContainerType } from './ADCFormat';\nimport AmbidecodeCoefs from './AmbidecodeCoefs';\nimport AmbidecodeSettings from './AmbidecodeSettings';\nimport IEMFormat from './IEMFormat';\nimport ADDFormat from './ADDFormat';\nimport { parse as parse_xml } from 'fast-xml-parser';\nlet formats = [\n    ADDFormat,\n    AmbidecodeCoefs,\n    AmbidecodeSettings,\n    IEMFormat\n];\nexport var ParserMessageLevels;\n(function (ParserMessageLevels) {\n    ParserMessageLevels[ParserMessageLevels[\"note\"] = 0] = \"note\";\n    ParserMessageLevels[ParserMessageLevels[\"warn\"] = 1] = \"warn\";\n    ParserMessageLevels[ParserMessageLevels[\"err\"] = 2] = \"err\";\n})(ParserMessageLevels || (ParserMessageLevels = {}));\nexport class ParserMessage {\n    constructor(mess, level) {\n        this.message = mess;\n        this.level = level;\n    }\n}\nexport class ParseResults {\n    constructor() {\n        this.results = [];\n        this.incomplete_results = [];\n        this.messages = [];\n    }\n}\nexport class ConvertableTextFile {\n    constructor(fname, data) {\n        this.filename = fname;\n        this.data = data;\n    }\n}\nexport class ConverterOption {\n    constructor(name, value) {\n        this.used = false;\n        this.name = name;\n        this.value = value;\n    }\n    type() { return typeof this.value; }\n    peek() { return this.value; }\n    wasUsed() { return this.used; }\n    use() {\n        this.used = true;\n        return this.value;\n    }\n}\nexport class ConverterOptions {\n    constructor(...args) {\n        this.options = [];\n        this.options = args;\n    }\n    has(name) {\n        return this.options.find(opt => opt.name === name) != undefined;\n    }\n    get(name) {\n        return this.options.find(opt => opt.name === name);\n    }\n    use(name) {\n        let opt = this.get(name);\n        if (opt)\n            return opt.use();\n    }\n    getUnused() {\n        return this.options.reduce((carry, current) => {\n            !current.used ? carry.push(current) : null;\n            return carry;\n        }, []);\n    }\n}\nexport const Converter = {\n    convert_string(files, options) {\n        let results = new ParseResults();\n        for (let file of files) {\n            let ftype = file.filename.slice((file.filename.lastIndexOf(\".\") - 1 >>> 0) + 2);\n            if (!(ftype === 'xml' || ftype === 'json' || ftype === 'add')) {\n                if (file.data.charAt(0) === '<')\n                    ftype = 'xml';\n                else if (file.data.charAt(0) === '{' || file.data.charAt(0) === '[')\n                    ftype = 'json';\n            }\n            switch (ftype) {\n                case 'json':\n                    this._do_parse_json(file, results, options);\n                    break;\n                case 'xml':\n                    this._do_parse_xml(file, results, options);\n                    break;\n                case 'add':\n                    this._do_parse_add(file, results, options);\n                    break;\n            }\n        }\n        return results;\n    },\n    convert_binary(filename, data, options) {\n    },\n    list_formats() {\n    },\n    _do_parse_json(file, carry, opts) {\n        this._do_parse_native(file, carry, opts, JSON.parse(file.data), ContainerType.JSON);\n    },\n    _do_parse_xml(file, carry, opts) {\n        this._do_parse_native(file, carry, opts, parse_xml(file.data, { ignoreAttributes: false }), ContainerType.XML);\n    },\n    _do_parse_add(file, carry, opts) {\n        ADDFormat.parse(JSON.parse(file.data), file.filename, carry, opts);\n    },\n    _do_parse_native(file, carry, opts, obj, container_type) {\n        let parsers_to_try = [];\n        let output_file = opts.use('output');\n        if (output_file)\n            console.log('output file: ' + output_file);\n        console.log();\n        console.log(\"Converting: \" + file.filename);\n        for (let format of formats) {\n            if (format.container_type() === container_type && format.test(obj))\n                parsers_to_try.push(format);\n        }\n        console.log('Matched the following parsers: ');\n        parsers_to_try.forEach(p => console.log(p.name));\n        parsers_to_try.forEach(parser => parser.parse(obj, file.filename, carry, opts));\n    }\n};\n"],"file":"Converter.js"}