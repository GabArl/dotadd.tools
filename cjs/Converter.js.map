{"version":3,"sources":["../build/Converter.js"],"names":["containerTypeToString","ty","ContainerType","CSV","JSON","XML","formats","ADDFormat","AmbidecodeCoefs","AmbidecodeSettings","IEMFormat","CSVFormat","ParserMessageLevels","ParserMessage","constructor","mess","level","message","ParseResults","results","incomplete_results","messages","output_files","ConvertableTextFile","fname","data","filename","ConverterOption","name","value","used","type","peek","wasUsed","use","ConverterOptions","args","options","has","find","opt","undefined","get","getUnused","reduce","carry","current","push","Converter","convert_string","files","file","ftype","slice","lastIndexOf","console","log","charAt","replace","split","join","_do_parse_json","_do_parse_xml","_do_parse_add","_do_parse_csv","_do_parse_ambdec","_do_apply_options","_do_convert","opts","ofopt","output","fileext","format","length","converter","frm","shortName","getName","forEach","res","fromADD","container_type","container","Error","mopts","description","author","version","norm","renormalize","_do_apply_options_impl","restash","add","shift","valid","setAuthor","setName","setDescription","hasOwnProperty","setVersion","Number","parseInt","decoder","matrices","dec","setNormalisation","toLowerCase","mat","renormalizeTo","_do_parse_native","parse","ignoreAttributes","Papa","AmbdecFormat","_do_parse_ambix_config","obj","parsers_to_try","test","map","p","parser"],"mappings":"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","sourcesContent":["import { ContainerType } from './ADCFormat';\nimport AmbidecodeCoefs from './AmbidecodeCoefs';\nimport AmbidecodeSettings from './AmbidecodeSettings';\nimport IEMFormat from './IEMFormat';\nimport ADDFormat from './ADDFormat';\nimport CSVFormat from './CSVFormat';\nimport { Logger as console } from './Logger';\nimport { parse as parse_xml } from 'fast-xml-parser';\nimport * as Papa from 'papaparse';\nimport AmbdecFormat from './AmbdecFormat';\nfunction containerTypeToString(ty) {\n    switch (ty) {\n        case ContainerType.CSV:\n            return \"csv\";\n        case ContainerType.JSON:\n            return \"json\";\n        case ContainerType.XML:\n            return \"xml\";\n    }\n}\nlet formats = [\n    ADDFormat,\n    AmbidecodeCoefs,\n    AmbidecodeSettings,\n    IEMFormat,\n    CSVFormat\n];\nexport var ParserMessageLevels;\n(function (ParserMessageLevels) {\n    ParserMessageLevels[ParserMessageLevels[\"note\"] = 0] = \"note\";\n    ParserMessageLevels[ParserMessageLevels[\"warn\"] = 1] = \"warn\";\n    ParserMessageLevels[ParserMessageLevels[\"err\"] = 2] = \"err\";\n})(ParserMessageLevels || (ParserMessageLevels = {}));\nexport class ParserMessage {\n    constructor(mess, level) {\n        this.message = mess;\n        this.level = level;\n    }\n}\nexport class ParseResults {\n    constructor() {\n        this.results = [];\n        this.incomplete_results = [];\n        this.messages = [];\n        this.output_files = [];\n    }\n}\nexport class ConvertableTextFile {\n    constructor(fname, data) {\n        this.filename = fname;\n        this.data = data;\n    }\n}\nexport class ConverterOption {\n    constructor(name, value) {\n        this.used = false;\n        this.name = name;\n        this.value = value;\n    }\n    type() { return typeof this.value; }\n    peek() { return this.value; }\n    wasUsed() { return this.used; }\n    use() {\n        this.used = true;\n        return this.value;\n    }\n}\nexport class ConverterOptions {\n    constructor(...args) {\n        this.options = [];\n        this.options = args;\n    }\n    has(name) {\n        return this.options.find(opt => opt.name === name) != undefined;\n    }\n    get(name) {\n        return this.options.find(opt => opt.name === name);\n    }\n    use(name) {\n        let opt = this.get(name);\n        if (opt)\n            return opt.use();\n    }\n    getUnused() {\n        return this.options.reduce((carry, current) => {\n            !current.used ? carry.push(current) : null;\n            return carry;\n        }, []);\n    }\n}\nexport const Converter = {\n    convert_string(files, options) {\n        let results = new ParseResults();\n        for (let file of files) {\n            let ftype = file.filename.slice((file.filename.lastIndexOf(\".\") - 1 >>> 0) + 2);\n            console.log(\"Processing file: \" + file.filename);\n            console.log(\"Filetype:        \" + ftype);\n            if (!(ftype === 'xml'\n                || ftype === 'json'\n                || ftype === 'add')) {\n                if (file.data.charAt(0) === '<')\n                    ftype = 'xml';\n                else if (file.data.charAt(0) === '{' || file.data.charAt(0) === '[')\n                    ftype = 'json';\n            }\n            file.filename = file.filename.replace(/^.*[\\\\\\/]/, '').split('.').slice(0, -1).join('.');\n            switch (ftype) {\n                case 'json':\n                    this._do_parse_json(file, results, options);\n                    break;\n                case 'xml':\n                    this._do_parse_xml(file, results, options);\n                    break;\n                case 'add':\n                    this._do_parse_add(file, results, options);\n                    break;\n                case 'csv':\n                    this._do_parse_csv(file, results, options);\n                    break;\n                case 'ambdec':\n                    this._do_parse_ambdec(file, results, options);\n                    break;\n                case 'config':\n                    break;\n            }\n        }\n        console.log(\"Applying command line options\");\n        this._do_apply_options(results, options);\n        this._do_convert(results, options);\n        return results;\n    },\n    _do_convert(carry, opts) {\n        let ofopt = opts.use('format');\n        let output = opts.use('output');\n        let fileext = \"\", format;\n        if (output)\n            fileext = output.slice((output.lastIndexOf(\".\") - 1 >>> 0) + 2);\n        if (ofopt)\n            format = ofopt;\n        else if (fileext.length)\n            format = fileext;\n        else\n            format = 'add';\n        let converter = formats.find(frm => frm.shortName() == format);\n        if (converter) {\n            console.log(\"Using '\" + converter.getName() + \"' exporter\");\n            carry.results.forEach(res => {\n                let data = converter.fromADD(res, opts);\n                console.log(\"Producing output: '\" + res.name + \"', format: '\" + format + \"', container: \" + containerTypeToString(converter.container_type()));\n                carry.output_files.push({\n                    name: res.name,\n                    format: format,\n                    container: containerTypeToString(converter.container_type()),\n                    data: data\n                });\n            });\n        }\n        else\n            throw new Error(\"Exporter '\" + format + \"' not found\");\n    },\n    _do_apply_options(carry, opts) {\n        let mopts = {\n            description: opts.use('description'),\n            name: opts.use('name'),\n            author: opts.use('author'),\n            version: opts.use('version'),\n            norm: opts.use('norm'),\n            renormalize: opts.use('reNorm'),\n        };\n        carry.results.forEach(res => this._do_apply_options_impl(res, mopts));\n        carry.incomplete_results.forEach(res => this._do_apply_options_impl(res, mopts));\n        let restash = [];\n        while (carry.incomplete_results.length) {\n            let add = carry.incomplete_results.shift();\n            if (add) {\n                console.log(\"reevaluating ADD '\" + add.name + \"'\");\n                if (add.valid()) {\n                    console.log(\"is valid now, appending to valid results\");\n                    carry.results.push(add);\n                }\n                else {\n                    restash.push(add);\n                    console.log(\"still invalid\");\n                }\n            }\n        }\n        carry.incomplete_results.push(...restash);\n    },\n    _do_apply_options_impl(add, opts) {\n        if (opts.author && typeof opts.author == 'string') {\n            console.log(\"setting author: \" + opts.author);\n            add.setAuthor(opts.author);\n        }\n        if (opts.name && typeof opts.name == 'string') {\n            console.log(\"setting name: \" + opts.name);\n            add.setName(opts.name);\n        }\n        if (opts.description && typeof opts.description == 'string') {\n            console.log(\"setting description: \" + opts.description);\n            add.setDescription(opts.description);\n        }\n        if (opts.hasOwnProperty('version') && typeof opts.version == 'number') {\n            console.log(\"setting version: \" + opts.version);\n            add.setVersion(Number.parseInt(opts.version));\n        }\n        if (opts.hasOwnProperty('norm') && typeof opts.norm == 'string') {\n            console.log(\"setting normalisation: \" + opts.norm);\n            add.decoder.matrices.forEach((dec) => dec.setNormalisation(opts.norm));\n        }\n        if (opts.renormalize && typeof opts.renormalize == 'string') {\n            console.log(\"renormalizing matrices to \" + opts.renormalize);\n            if (opts.renormalize.toLowerCase() == 'sn3d' ||\n                opts.renormalize.toLowerCase() == 'n3d') {\n                add.decoder.matrices.forEach(mat => mat.renormalizeTo(opts.renormalize));\n            }\n        }\n    },\n    _do_parse_json(file, carry, opts) {\n        this._do_parse_native(file, carry, opts, JSON.parse(file.data), ContainerType.JSON);\n    },\n    _do_parse_xml(file, carry, opts) {\n        this._do_parse_native(file, carry, opts, parse_xml(file.data, { ignoreAttributes: false }), ContainerType.XML);\n    },\n    _do_parse_add(file, carry, opts) {\n        console.log(\"Loading .add file '\" + file.filename + \"'\");\n        ADDFormat.parse(JSON.parse(file.data), file.filename, carry, opts);\n    },\n    _do_parse_csv(file, carry, opts) {\n        console.log(\"Parsing CSV file '\" + file.filename + \"'\");\n        CSVFormat.parse(Papa.parse(file.data), file.filename, carry, opts);\n    },\n    _do_parse_ambdec(file, carry, opts) {\n        console.log(\"Parsing ambdec file '\" + file.filename + \"'\");\n        AmbdecFormat.parse(file, file.filename, carry, opts);\n    },\n    _do_parse_ambix_config(file, carry, opts) {\n    },\n    _do_parse_native(file, carry, opts, obj, container_type) {\n        let parsers_to_try = [];\n        for (let format of formats) {\n            if (format.container_type() === container_type && format.test(obj))\n                parsers_to_try.push(format);\n        }\n        console.log(\"Parsing '\" + file.filename + \"' with '\" + parsers_to_try.map(p => p.getName() + \"' parser\"));\n        parsers_to_try.forEach(parser => parser.parse(obj, file.filename, carry, opts));\n    }\n};\n"],"file":"Converter.js"}