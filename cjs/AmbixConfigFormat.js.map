{"version":3,"sources":["../build/AmbixConfigFormat.js"],"names":["__decorate","decorators","target","key","desc","c","arguments","length","r","Object","getOwnPropertyDescriptor","d","Reflect","decorate","i","defineProperty","ParserState","AmbixConf","constructor","debug_msg","coef_scale","coef_seq","cflip","cflop","cflap","dec_mat_gain","invert_condon_shortley","coefs","AmbixConfigFormat","shortName","getName","getDescription","container_type","ContainerType","CONFIG","test","obj","parse","file","filename","carry","options","add","ADD","ambix","lines","ambixRemoveComments","data","split","pstate","DEFAULT","forEach","line","ambixReadLine","toLowerCase","ParseError","ambixDecApplyOptions","ambixDecFillZeroes","setName","setDescription","addMatrix","Matrix","setAuthor","createDefaultMetadata","createDefaultOutputs","addMakeImags","valid","results","push","incomplete_results","fromADD","opts","max_s","reduce","len","row","state","GLOBAL","ambixReadGlobalValue","DEC_MAT","ambixReadDecoderRow","HRTF_SECT","ambixReadHrtfSection","ambixReadDefault","includes","map","str","Number","parseFloat","vals","shift","join","parseInt","trim","decoder","matrices","matrix","is_nul","coef","output","summing_matrix","fill","flip","flop","flap","total","flipp","flapp","flopp","cshortley","m","ACN","index","l","order","Math","pow"],"mappings":"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","sourcesContent":["var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nimport { ContainerType, _static_implements } from \"./ADCFormat\";\nimport { ADD, ACN, Matrix } from 'dotadd.js';\nimport { ParseError } from \"./Util\";\nvar ParserState;\n(function (ParserState) {\n    ParserState[ParserState[\"GLOBAL\"] = 0] = \"GLOBAL\";\n    ParserState[ParserState[\"HRTF_SECT\"] = 1] = \"HRTF_SECT\";\n    ParserState[ParserState[\"DEC_MAT\"] = 2] = \"DEC_MAT\";\n    ParserState[ParserState[\"DEFAULT\"] = 3] = \"DEFAULT\";\n})(ParserState || (ParserState = {}));\nclass AmbixConf {\n    constructor() {\n        this.debug_msg = \"\";\n        this.coef_scale = \"\";\n        this.coef_seq = \"\";\n        this.cflip = 0;\n        this.cflop = 0;\n        this.cflap = 0;\n        this.dec_mat_gain = 1.;\n        this.invert_condon_shortley = false;\n        this.coefs = [];\n    }\n}\nlet AmbixConfigFormat = class AmbixConfigFormat {\n    static shortName() {\n        return \"ambix\";\n    }\n    /**\n     * @returns {string} the name of the format\n     */\n    static getName() {\n        return \"AmbiX Configuration Files\";\n    }\n    /**\n     * @returns {string} a string describing the format\n     */\n    static getDescription() {\n        return \"Read and write configurations files for the AmbiX Plugin Suite by Matthias Kronlachner\";\n    }\n    /**\n     * @returns {ContainerType} the container type for this format\n     */\n    static container_type() {\n        return ContainerType.CONFIG;\n    }\n    /**\n     * test if an object can be interpreted by this format\n     * @param obj object to test\n     */\n    static test(obj) {\n        return false;\n    }\n    /**\n     * parse the format\n     * @param obj object to parse\n     * @param filename filename of the parsed object\n     * @param carry carried from the last iteration if the parser needs/accepts more than one file\n     * @param options converter options\n     */\n    static parse(file, filename, carry, options) {\n        let add = new ADD();\n        let ambix = new AmbixConf();\n        let lines = ambixRemoveComments(file.data.split('\\n'));\n        let pstate = ParserState.DEFAULT;\n        lines.forEach(line => pstate = ambixReadLine(ambix, line, pstate));\n        if (!(ambix.coef_scale.toLowerCase() === 'sn3d'\n            || ambix.coef_scale.toLowerCase() === 'n3d'))\n            throw new ParseError(filename + '.config', \"Unexpected normalization: '\" + ambix.coef_scale + \"'\");\n        ambixDecApplyOptions(ambix);\n        ambixDecFillZeroes(ambix);\n        add.setName((ambix.debug_msg.length) ? ambix.debug_msg : filename);\n        add.setDescription(\"Parsed from ambix decoder configuration file / \" + \"filename\" + \".config\");\n        add.addMatrix(new Matrix(ambix.coef_scale, ambix.coefs));\n        add.setAuthor(\"Matthias Kronlachner feat. the dotaddtool creators\");\n        add.createDefaultMetadata();\n        add.createDefaultOutputs();\n        addMakeImags(add);\n        if (add.valid())\n            carry.results.push(add);\n        else\n            carry.incomplete_results.push(add);\n    }\n    static fromADD(add, opts) {\n        return \"\";\n    }\n};\nAmbixConfigFormat = __decorate([\n    _static_implements()\n], AmbixConfigFormat);\nexport default AmbixConfigFormat;\n;\nfunction ambixDecFillZeroes(ambix) {\n    let max_s = ambix.coefs\n        .reduce((len, row) => ((len > row.length) ? len : row.length), 0);\n    ambix.coefs.forEach(row => {\n        while (!(row.length === max_s))\n            row.push(0);\n    });\n}\nfunction ambixReadLine(ambix, line, state) {\n    switch (state) {\n        case ParserState.GLOBAL:\n            return ambixReadGlobalValue(ambix, line);\n        case ParserState.DEC_MAT:\n            return ambixReadDecoderRow(ambix, line);\n        case ParserState.HRTF_SECT:\n            return ambixReadHrtfSection(ambix, line);\n        default:\n            return ambixReadDefault(ambix, line);\n    }\n}\nfunction ambixReadDefault(ambix, line) {\n    if (line.includes(\"#GLOBAL\"))\n        return ParserState.GLOBAL;\n    if (line.includes(\"#HRTF\"))\n        return ParserState.HRTF_SECT;\n    if (line.includes(\"#DECODERMATRIX\"))\n        return ParserState.DEC_MAT;\n    return ParserState.DEFAULT;\n}\nfunction ambixReadHrtfSection(ambix, line) {\n    if (line.includes(\"#END\"))\n        return ParserState.DEFAULT;\n    return ParserState.HRTF_SECT;\n}\nfunction ambixReadDecoderRow(ambix, line) {\n    if (line.includes(\"#END\"))\n        return ParserState.DEFAULT;\n    let coefs = line.split(/\\s+/).map(str => Number.parseFloat(str));\n    ambix.coefs.push(coefs);\n    return ParserState.DEC_MAT;\n}\nfunction ambixReadGlobalValue(ambix, line) {\n    if (line.includes(\"#END\"))\n        return ParserState.DEFAULT;\n    let vals = line.split(/\\s+/);\n    switch (vals.shift()) {\n        case '/debug_msg':\n            ambix.debug_msg = vals.join(\" \");\n        case '/coeff_scale':\n            ambix.coef_scale = vals.shift();\n        case '/coeff_seq':\n            ambix.coef_seq = vals.shift();\n        case '/flip':\n            ambix.cflip = Number.parseInt(vals.shift());\n        case '/flap':\n            ambix.cflap = Number.parseInt(vals.shift());\n        case '/flop':\n            ambix.cflop = Number.parseInt(vals.shift());\n        case '/dec_mat_gain':\n            ambix.dec_mat_gain = Number.parseFloat(vals.shift());\n        case '/invert_condon_shortley':\n            ambix.invert_condon_shortley = Number.parseInt(vals.shift()) === 1;\n    }\n    return ParserState.GLOBAL;\n}\nfunction ambixRemoveComments(lines) {\n    return lines.map(line => { return line.split(\"//\")[0].trim(); });\n}\nfunction addMakeImags(add) {\n    add.decoder.matrices[0].matrix.forEach((row, i) => {\n        if (row.reduce((is_nul, coef) => is_nul && (coef == 0), true))\n            add.decoder.output.summing_matrix[i].fill(0);\n    });\n}\nfunction ambixDecApplyOptions(ambix) {\n    let flip = 1, flop = 1, flap = 1, total = 1;\n    let flipp = ambix.cflip === 1;\n    let flapp = ambix.cflap === 1;\n    let flopp = ambix.cflop === 1;\n    let cshortley = ambix.invert_condon_shortley;\n    if (cshortley || flipp || flapp || flopp) {\n        ambix.coefs.forEach(row => {\n            row.forEach((coef, i) => {\n                let m = ACN.index(i);\n                let l = ACN.order(i);\n                // this section is copied 1::1 from the kronlachner plugins code\n                if (flipp && (m < 0)) // m < 0 -> invert\n                    flip = -1;\n                if (flopp && (((m < 0) && !(m % 2)) || ((m >= 0) && (m % 2)))) // m < 0 and even || m >= 0 and odd ()\n                    flop = -1;\n                if (flapp && ((l + m) % 2)) // l+m odd   ( (odd, even) or (even, odd) )\n                    flap = -1;\n                if (cshortley)\n                    total = Math.pow(-1, i) * flip * flop * flap;\n                else\n                    total = flip * flop * flap;\n                row[i] = coef * total;\n            });\n        });\n    }\n}\n"],"file":"AmbixConfigFormat.js"}